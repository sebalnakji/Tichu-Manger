{% extends "base.html" %}

{% block title %}íŒ€ ì„ íƒ - Tichu Manager{% endblock %}

{% block content %}
<style>
    :root {
        --bg-main: #F9FAFB;
        --bg-card: #FFFFFF;
        --bg-card-sub: #F3F4F6;
        --border: rgba(0,0,0,0.07);
        --border-dashed: #E5E7EB;
        --text-primary: #1F2937;
        --text-secondary: #6B7280;
        --text-muted: #9CA3AF;
        --accent: #3B82F6;
        --accent-light: #EFF6FF;
        --accent-light-border: #BFDBFE;
        --slot-empty-bg: #F9FAFB;
        --progress-track: #F3F4F6;
        --progress-fill: #3B82F6;
        --player-card-bg: #FFFFFF;
        --player-card-selected-bg: #EFF6FF;
        --player-stats-bg: #F3F4F6;
        --modal-bg: #FFFFFF;
        --modal-inner-bg: #F9FAFB;
        --bottom-grad-from: #FFFFFF;
        --scrollbar-color: #E5E7EB;
        --team-a-border: #3B82F6;
        --team-a-text: #1E3A8A;
        --team-a-stats: #2563EB;
        --team-a-badge-bg: #DBEAFE;
        --team-a-badge-text: #2563EB;
        --team-b-border: #EF4444;
        --team-b-text: #7F1D1D;
        --team-b-stats: #DC2626;
        --team-b-badge-bg: #FEE2E2;
        --team-b-badge-text: #DC2626;
        --divider: #F3F4F6;
    }

    [data-theme="dark"] {
        --bg-main: #111827;
        --bg-card: #1F2937;
        --bg-card-sub: #111827;
        --border: rgba(255,255,255,0.08);
        --border-dashed: #374151;
        --text-primary: #F9FAFB;
        --text-secondary: #9CA3AF;
        --text-muted: #6B7280;
        --accent: #60A5FA;
        --accent-light: rgba(96,165,250,0.15);
        --accent-light-border: rgba(96,165,250,0.4);
        --slot-empty-bg: rgba(255,255,255,0.03);
        --progress-track: #374151;
        --progress-fill: #60A5FA;
        --player-card-bg: #1F2937;
        --player-card-selected-bg: rgba(96,165,250,0.15);
        --player-stats-bg: rgba(255,255,255,0.05);
        --modal-bg: #1F2937;
        --modal-inner-bg: #111827;
        --bottom-grad-from: #111827;
        --scrollbar-color: #374151;
        --team-a-border: #60A5FA;
        --team-a-text: #BFDBFE;
        --team-a-stats: #93C5FD;
        --team-a-badge-bg: rgba(96,165,250,0.2);
        --team-a-badge-text: #93C5FD;
        --team-b-border: #F87171;
        --team-b-text: #FECACA;
        --team-b-stats: #FCA5A5;
        --team-b-badge-bg: rgba(248,113,113,0.2);
        --team-b-badge-text: #FCA5A5;
        --divider: rgba(255,255,255,0.05);
    }

    .page-bg { background-color: var(--bg-main); }
    .ts-header { background-color: var(--bg-card); border-bottom: 1px solid var(--border); }
    .ts-back-btn { color: var(--text-secondary); }
    .ts-back-btn:hover { background-color: var(--bg-card-sub); }
    .ts-title { color: var(--text-primary); }
    .ts-add-btn { color: var(--accent); }
    .ts-add-btn:hover { background-color: var(--bg-card-sub); }
    .slot-empty { background-color: var(--slot-empty-bg); border: 2px dashed var(--border-dashed); color: var(--text-muted); }
    .slot-selected { background-color: var(--accent-light); border: 2px solid var(--accent-light-border); }
    .progress-track { background-color: var(--progress-track); }
    .progress-fill { background-color: var(--progress-fill); }
    .player-card { background-color: var(--player-card-bg); border: 1px solid var(--border); border-radius: 1rem; box-shadow: 0 1px 4px rgba(0,0,0,0.04); transition: all 0.15s; }
    .player-card.selected { background-color: var(--player-card-selected-bg); border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent); }
    .player-name { color: var(--text-primary); }
    .player-name.selected { color: var(--accent); }
    .player-stats { background-color: var(--player-stats-bg); }
    .stat-label { color: var(--text-secondary); }
    .stat-value { color: var(--text-secondary); }
    .stat-value.hot { color: #EF4444; font-weight: 700; }
    .section-label { color: var(--text-muted); }
    .bottom-grad { background: linear-gradient(to top, var(--bottom-grad-from) 60%, transparent); }
    .assign-btn-disabled { background-color: var(--bg-card-sub); color: var(--text-muted); }
    .assign-btn-active { background-color: #10B981; color: white; box-shadow: 0 4px 16px rgba(16,185,129,0.3); }
    [data-theme="dark"] .assign-btn-active { background-color: #10B981; }
    .result-modal { background-color: var(--modal-bg); }
    .result-modal-inner { background-color: var(--modal-inner-bg); }
    .result-modal-title { color: var(--text-primary); }
    .result-modal-divider { border-color: var(--divider); }
    .team-a-card { background-color: var(--modal-bg); border-left: 4px solid var(--team-a-border); }
    .team-b-card { background-color: var(--modal-bg); border-left: 4px solid var(--team-b-border); }
    .team-a-title { color: var(--team-a-text); }
    .team-b-title { color: var(--team-b-text); }
    .team-a-stats-text { color: var(--team-a-stats); }
    .team-b-stats-text { color: var(--team-b-stats); }
    .team-a-badge { background-color: var(--team-a-badge-bg); color: var(--team-a-badge-text); }
    .team-b-badge { background-color: var(--team-b-badge-bg); color: var(--team-b-badge-text); }
    .player-row { background-color: var(--bg-card-sub); border: 1px solid var(--divider); border-radius: 0.5rem; }
    .player-row-name { color: var(--text-primary); }
    .player-row-stat { color: var(--text-muted); }
    .result-modal-footer { background-color: var(--modal-bg); border-top: 1px solid var(--divider); }
    .start-btn { background-color: #10B981; color: white; transition: background-color 0.2s, transform 0.15s; }
    .start-btn:hover { background-color: #059669; }
    .start-btn:active { transform: scale(0.98); }
    [data-theme="dark"] .start-btn { background-color: #10B981; }
    .close-btn { color: var(--text-muted); }
    .close-btn:hover { color: var(--text-secondary); }
    .add-modal { background-color: var(--modal-bg); }
    .add-modal-title { color: var(--text-primary); }
    .add-modal-label { color: var(--text-muted); }
    .add-modal-input { background-color: var(--bg-card-sub); border: 1px solid var(--border); color: var(--text-primary); border-radius: 0.75rem; padding: 0.75rem 1rem; width: 100%; outline: none; transition: border-color 0.15s; }
    .add-modal-input:focus { border-color: var(--accent); }
    .add-modal-input::placeholder { color: var(--text-muted); }
    .add-modal-cancel { background-color: var(--bg-card-sub); color: var(--text-secondary); border-radius: 0.75rem; font-weight: 700; padding: 0.75rem; }
    .add-modal-submit { background-color: #10B981; color: white; border-radius: 0.75rem; font-weight: 700; padding: 0.75rem; }
    .add-modal-submit:hover { background-color: #059669; }
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background-color: var(--scrollbar-color); border-radius: 20px; }
</style>

<div class="page-bg min-h-screen flex flex-col relative">
    <div class="sticky top-0 z-40 ts-header shadow-sm transition-all duration-300">
        <div class="max-w-lg mx-auto px-4 py-3">
            <div class="flex items-center justify-between mb-4">
                <a href="/" class="p-2 -ml-2 rounded-full transition ts-back-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </a>
                <h2 class="text-lg font-black tracking-tight ts-title">ë©¤ë²„ ì„ íƒ</h2>
                <button id="add-member-btn" class="text-2xl p-2 -mr-2 rounded-full transition ts-add-btn">
                    <span id="add-member-icon">â•</span>
                    <span id="add-member-lock" class="hidden text-sm">ğŸ”’</span>
                </button>
            </div>
            <div class="flex justify-between items-center gap-2">
                <div id="selected-slots" class="grid grid-cols-4 gap-2 w-full"></div>
            </div>
            <div class="mt-3 w-full progress-track h-1 rounded-full overflow-hidden">
                <div id="progress-bar" class="progress-fill h-full transition-all duration-300 ease-out" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <div class="flex-1 max-w-lg mx-auto w-full px-4 pt-4 pb-32">
        <div class="flex justify-between items-end mb-3 px-1">
            <h3 class="text-sm font-bold section-label uppercase tracking-wider">ì „ì²´ í”Œë ˆì´ì–´</h3>
            <span class="text-xs font-medium section-label">ìµœê·¼ ì „ì  ìˆœ</span>
        </div>
        <div id="all-players-list" class="grid grid-cols-2 gap-3"></div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 z-50 bottom-grad pt-8 pb-6 px-4">
        <div class="max-w-lg mx-auto">
            <button id="assign-teams-btn" class="w-full h-14 font-bold rounded-2xl shadow-sm transition-all duration-300 flex items-center justify-center gap-2 disabled:cursor-not-allowed touch-manipulation assign-btn-disabled" disabled>
                <span class="text-xl opacity-50">ğŸ²</span>
                <span id="assign-teams-text">4ëª…ì„ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            </button>
        </div>
    </div>

    <div id="result-overlay" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-gray-900/80 backdrop-blur-sm transition-opacity p-4">
        <div class="result-modal rounded-3xl shadow-2xl w-full max-w-md overflow-hidden transform scale-100 transition-transform duration-300 relative flex flex-col max-h-[90vh]">
            <button onclick="closeResultModal()" class="absolute top-4 right-4 z-10 p-2 close-btn">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div class="p-6 text-center border-b result-modal-divider shrink-0">
                <h3 class="text-2xl font-black result-modal-title">âš”ï¸ ë§¤ì¹˜ì—… ì„±ì‚¬!</h3>
            </div>
            <div class="p-6 space-y-6 result-modal-inner overflow-y-auto custom-scrollbar">
                <div class="team-a-card rounded-2xl p-4 shadow-sm">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 id="team-a-title" class="text-lg font-black team-a-title">TEAM A</h4>
                            <div id="team-a-stats" class="text-xs font-medium mt-1 team-a-stats-text"></div>
                        </div>
                        <span class="text-xs font-bold px-2 py-1 rounded team-a-badge">HOME</span>
                    </div>
                    <div id="team-a-players" class="space-y-2"></div>
                </div>
                <div class="flex justify-center -my-3 relative z-10">
                    <div class="bg-red-500 text-white font-black text-sm px-3 py-1 rounded-full shadow-md border-2 border-white">VS</div>
                </div>
                <div class="team-b-card rounded-2xl p-4 shadow-sm">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 id="team-b-title" class="text-lg font-black team-b-title">TEAM B</h4>
                            <div id="team-b-stats" class="text-xs font-medium mt-1 team-b-stats-text"></div>
                        </div>
                        <span class="text-xs font-bold px-2 py-1 rounded team-b-badge">AWAY</span>
                    </div>
                    <div id="team-b-players" class="space-y-2"></div>
                </div>
            </div>
            <div class="p-4 result-modal-footer shrink-0">
                <button id="start-game-btn" class="w-full start-btn font-bold py-4 rounded-xl text-lg shadow-lg flex items-center justify-center gap-2 active:scale-[0.98]">
                    <span>ğŸš€ ê²Œì„ ì‹œì‘í•˜ê¸°</span>
                </button>
            </div>
        </div>
    </div>

    <div id="add-member-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm px-4">
        <div class="add-modal rounded-3xl p-6 w-full max-w-sm shadow-2xl transform transition-all">
            <div class="text-center mb-6">
                <div class="w-14 h-14 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl">ğŸ‘¤</div>
                <h3 class="text-xl font-bold add-modal-title">ìƒˆ ë©¤ë²„ ë“±ë¡</h3>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold uppercase mb-1 ml-1 add-modal-label">ë‹‰ë„¤ì„</label>
                    <input type="text" id="new-member-name" class="add-modal-input" placeholder="ì˜ˆ: í‹°ì¸„ì™•">
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase mb-1 ml-1 add-modal-label">ì ‘ì† ì½”ë“œ</label>
                    <input type="text" id="new-member-code" class="add-modal-input" placeholder="ê³µë°± ì—†ì´ ì…ë ¥">
                </div>
                <div id="add-member-error" class="hidden p-3 bg-red-50 text-red-600 text-xs rounded-lg flex items-center gap-2">
                    <span id="error-msg">ì—ëŸ¬ ë©”ì‹œì§€</span>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-3 mt-6">
                <button onclick="closeAddMemberModal()" class="add-modal-cancel">ì·¨ì†Œ</button>
                <button onclick="createNewMember()" class="add-modal-submit">ë“±ë¡</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        loadPlayers();
        updateUIByAuthState();
        setupEventListeners();
        renderEmptySlots();
    });

    let selectedPlayers = [];
    let allPlayersData = [];
    let teamAssignment = null;

    function updateUIByAuthState() {
        const isAuth = AuthManager.isAuthenticated();
        const addMemberLock = document.getElementById('add-member-lock');
        if (!isAuth) { addMemberLock.classList.remove('hidden'); } else { addMemberLock.classList.add('hidden'); }
    }

    function renderEmptySlots() {
        const container = document.getElementById('selected-slots');
        container.innerHTML = '';
        selectedPlayers.forEach(id => {
            const player = allPlayersData.find(p => p.id === id);
            if (player) {
                container.innerHTML += `
                    <div class="aspect-square rounded-xl slot-selected flex flex-col items-center justify-center relative cursor-pointer group" onclick="togglePlayerSelection(${player.id})">
                        <img src="${player.profile_url}" class="w-full h-full object-cover rounded-lg opacity-90">
                        <div class="absolute inset-0 bg-black/10 flex items-center justify-center rounded-lg opacity-0 group-hover:opacity-100 transition"><span class="text-white font-bold text-xs">ì·¨ì†Œ</span></div>
                        <div class="absolute -bottom-1 left-0 right-0 text-center">
                            <span class="text-[10px] font-bold bg-white px-1.5 py-0.5 rounded-full border border-gray-100 shadow-sm truncate max-w-[90%] inline-block">${player.name}</span>
                        </div>
                    </div>`;
            }
        });
        const emptyCount = 4 - selectedPlayers.length;
        for (let i = 0; i < emptyCount; i++) {
            container.innerHTML += `<div class="aspect-square rounded-xl slot-empty flex flex-col items-center justify-center"><span class="text-xl font-light">+</span><span class="text-[10px]">ì„ íƒ</span></div>`;
        }
    }

    async function loadPlayers() {
        try {
            const [playersResponse, statsResponse] = await Promise.all([fetch('/api/players'), fetch('/api/stats/players/current-year')]);
            allPlayersData = await playersResponse.json();
            const statsData = await statsResponse.json();
            allPlayersData = allPlayersData.map(player => {
                const stats = statsData.find(s => s.player_id === player.id);
                return { ...player, win_rate: stats ? stats.win_rate : 0, recent_win_rate: stats ? stats.recent_win_rate : 0 };
            });
            renderAllPlayers();
            renderEmptySlots();
        } catch (error) { console.error('Error:', error); }
    }

    function renderAllPlayers() {
        const list = document.getElementById('all-players-list');
        list.innerHTML = '';
        if (allPlayersData.length === 0) {
            list.innerHTML = `<div class="col-span-full text-center py-10 section-label">ë“±ë¡ëœ í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            return;
        }
        allPlayersData.forEach(player => {
            const isSelected = selectedPlayers.includes(player.id);
            const div = document.createElement('div');
            div.className = `player-card ${isSelected ? 'selected' : ''} relative p-3 cursor-pointer flex flex-col items-center gap-2 active:scale-95 touch-manipulation`;
            div.innerHTML = `
                <div class="relative w-14 h-14">
                    <img src="${player.profile_url}" class="w-full h-full rounded-full object-cover ${isSelected ? 'grayscale opacity-70' : ''}">
                    ${isSelected ? `<div class="absolute inset-0 flex items-center justify-center rounded-full bg-blue-500/20"><span class="text-blue-600 font-bold text-xl">âœ“</span></div>` : ''}
                </div>
                <div class="text-center w-full">
                    <p class="font-bold text-sm truncate mb-1 player-name ${isSelected ? 'selected' : ''}">${player.name}</p>
                    <div class="player-stats rounded-lg px-2 py-1 flex flex-col gap-0.5 text-[10px] w-full">
                        <div class="flex justify-between w-full"><span class="stat-label">ì‹œì¦Œ</span><span class="stat-value ${player.win_rate >= 80 ? 'hot' : ''}">${player.win_rate}%</span></div>
                        <div class="flex justify-between w-full"><span class="stat-label">ìµœê·¼</span><span class="stat-value ${player.recent_win_rate >= 80 ? 'hot' : ''}">${player.recent_win_rate}%</span></div>
                    </div>
                </div>`;
            div.onclick = () => togglePlayerSelection(player.id);
            list.appendChild(div);
        });
    }

    function togglePlayerSelection(playerId) {
        const index = selectedPlayers.indexOf(playerId);
        if (index > -1) { selectedPlayers.splice(index, 1); }
        else {
            if (selectedPlayers.length >= 4) { if (navigator.vibrate) navigator.vibrate(50); return; }
            selectedPlayers.push(playerId);
            if (navigator.vibrate) navigator.vibrate(10);
        }
        updateProgress(); renderAllPlayers(); renderEmptySlots();
    }

    function updateProgress() {
        const count = selectedPlayers.length;
        document.getElementById('progress-bar').style.width = `${(count / 4) * 100}%`;
        const btn = document.getElementById('assign-teams-btn');
        const btnText = document.getElementById('assign-teams-text');
        if (count === 4) {
            btn.classList.remove('assign-btn-disabled'); btn.classList.add('assign-btn-active');
            btn.disabled = false; btn.querySelector('.text-xl').style.opacity = '1';
            btnText.textContent = AuthManager.isAuthenticated() ? 'íŒ€ ë°°ì •í•˜ê¸°' : 'ë¡œê·¸ì¸ í›„ ë°°ì •';
        } else {
            btn.classList.add('assign-btn-disabled'); btn.classList.remove('assign-btn-active');
            btn.disabled = true; btn.querySelector('.text-xl').style.opacity = '0.5';
            btnText.textContent = `${4 - count}ëª… ë” ì„ íƒ`;
        }
    }

    function setupEventListeners() {
        document.getElementById('add-member-btn').onclick = () => {
            if (!AuthManager.isAuthenticated()) { AuthManager.showAuthModal(() => { updateUIByAuthState(); showAddMemberModal(); }); }
            else { showAddMemberModal(); }
        };
        document.getElementById('assign-teams-btn').onclick = () => {
            if (selectedPlayers.length !== 4) return;
            if (!AuthManager.isAuthenticated()) { AuthManager.showAuthModal(() => { updateUIByAuthState(); assignTeams(); }); }
            else { assignTeams(); }
        };
        document.getElementById('start-game-btn').onclick = startGame;
    }

    function showAddMemberModal() {
        document.getElementById('add-member-modal').classList.remove('hidden');
        document.getElementById('new-member-name').value = '';
        document.getElementById('new-member-code').value = '';
        document.getElementById('add-member-error').classList.add('hidden');
    }
    function closeAddMemberModal() { document.getElementById('add-member-modal').classList.add('hidden'); }
    function closeResultModal() { document.getElementById('result-overlay').classList.add('hidden'); }

    async function createNewMember() {
        const name = document.getElementById('new-member-name').value.trim();
        const code = document.getElementById('new-member-code').value;
        const errorDiv = document.getElementById('add-member-error');
        const errorMsg = document.getElementById('error-msg');
        if (!name || !code || /\s/.test(code)) { errorMsg.textContent = 'ì´ë¦„ê³¼ ê³µë°± ì—†ëŠ” ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'; errorDiv.classList.remove('hidden'); return; }
        try {
            const res = await fetch('/api/players/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, code }) });
            if (!res.ok) { const error = await res.json(); throw new Error(error.detail); }
            closeAddMemberModal(); await loadPlayers();
        } catch (e) { errorMsg.textContent = e.message || 'ë“±ë¡ ì‹¤íŒ¨'; errorDiv.classList.remove('hidden'); }
    }

    async function assignTeams() {
        try {
            const res = await fetch('/api/matches/assign-teams', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(selectedPlayers) });
            teamAssignment = await res.json();
            displayTeamResult(teamAssignment);
        } catch (e) { alert('ë°°ì • ì‹¤íŒ¨'); }
    }

    async function displayTeamResult(teams) {
        const fillTeam = async (ids, containerId) => {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            for (const id of ids) {
                const p = allPlayersData.find(x => x.id === id);
                container.innerHTML += `
                    <div class="flex items-center gap-3 player-row w-full p-2">
                        <img src="${p.profile_url}" class="w-8 h-8 rounded-full bg-gray-100 object-cover">
                        <div class="flex-1 min-w-0 text-left">
                            <span class="font-bold text-sm block truncate player-row-name">${p.name}</span>
                            <div class="flex gap-2 text-[10px]"><span class="player-row-stat">ì‹œì¦Œ ${p.win_rate}%</span><span class="player-row-stat">ìµœê·¼ ${p.recent_win_rate}%</span></div>
                        </div>
                    </div>`;
            }
        };
        await fillTeam(teams.team_a, 'team-a-players');
        await fillTeam(teams.team_b, 'team-b-players');
        const teamAGames = teams.team_a_stats.total_games, teamAWins = teams.team_a_stats.wins;
        document.getElementById('team-a-stats').innerHTML = teamAGames > 0 ? `ì „ì : ${teamAWins}ìŠ¹ ${teamAGames - teamAWins}íŒ¨ (${teams.team_a_stats.win_rate}%)` : 'ì²« ë§Œë‚¨! ğŸ”¥';
        const teamBGames = teams.team_b_stats.total_games, teamBWins = teams.team_b_stats.wins;
        document.getElementById('team-b-stats').innerHTML = teamBGames > 0 ? `ì „ì : ${teamBWins}ìŠ¹ ${teamBGames - teamBWins}íŒ¨ (${teams.team_b_stats.win_rate}%)` : 'ì²« ë§Œë‚¨! ğŸ”¥';
        document.getElementById('result-overlay').classList.remove('hidden');
    }

    async function startGame() {
        try {
            const res = await fetch('/api/matches/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ team_a_ids: teamAssignment.team_a, team_b_ids: teamAssignment.team_b }) });
            const match = await res.json();
            window.location.href = `/scoreboard/${match.id}`;
        } catch (e) { alert('ì‹œì‘ ì‹¤íŒ¨'); }
    }
</script>
{% endblock %}